(()=>{"use strict";var e={117:(e,t,n)=>{e.exports=n.p+"6666407ac3aa5af1d5de.jpg"},576:(e,t,n)=>{e.exports=n.p+"fc3e6875d825f899a98d.svg"},629:(e,t,n)=>{e.exports=n.p+"8667ac4a523e8fc42e59.svg"}},t={};function n(o){var r=t[o];if(void 0!==r)return r.exports;var c=t[o]={exports:{}};return e[o](c,c.exports,n),c.exports}n.m=e,n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.p="",n.b=document.baseURI||self.location.href;var o=function(e,t){!function(e){return Array.from(e).some((function(e){return!e.validity.valid}))}(e)?(t.classList.remove("popup__button_type_disabled"),t.disabled=!1):(t.classList.add("popup__button_type_disabled"),t.disabled=!0)};function r(e){e.addEventListener("click",(function(t){!function(e,t){e.target.classList.contains("popup")&&c(t)}(t,e)})),document.addEventListener("keydown",a),e.classList.add("popup_is-opened")}function c(e){document.removeEventListener("keydown",a),e.classList.remove("popup_is-opened")}function a(e){"Escape"===e.key&&c(document.querySelector(".popup_is-opened"))}var i="apf-cohort-202",u="35ced132-4af8-4e9f-9801-f8412e445272";function s(){return fetch("https://nomoreparties.co/v1/".concat(i,"/users/me"),{method:"GET",headers:{authorization:u,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.error("Ошибка получения информации о пользователе: ".concat(e))}))}function p(){return fetch("https://nomoreparties.co/v1/".concat(i,"/cards"),{method:"GET",headers:{authorization:u,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.error("Произошла ошибка при загрузке карточек:",e)}))}function l(e,t){t.textContent=e?"Сохранение...":"Сохранить"}var d,f=document.querySelector("#card-template").content,_=document.querySelector(".popup_type_image"),y=_.querySelector(".popup__image"),m=_.querySelector(".popup__caption");function h(e,t){var n=f.querySelector(".card").cloneNode(!0),o=n.querySelector(".card__image"),c=n.querySelector(".card__title"),a=n.querySelector(".card__like-button"),s=n.querySelector(".card__delete-button"),p=n.querySelector(".card__span");return e.likes=e.likes||[],o.src=e.link,o.alt=e.name,c.textContent=e.name,p.textContent=e.likes.length,e.likes.some((function(e){return e._id===t}))&&a.classList.add("card__like-button_is-active"),a.addEventListener("click",(function(){var t;(a.classList.contains("card__like-button_is-active")?(t=e._id,fetch("https://nomoreparties.co/v1/".concat(i,"/cards/likes/").concat(t),{method:"DELETE",headers:{authorization:u,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){throw console.error("Ошибка «лайка» на карточке:",e),e}))):function(e){return fetch("https://nomoreparties.co/v1/".concat(i,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:u,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){throw console.error("Ошибка «лайка» на карточке:",e),e}))}(e._id)).then((function(e){a.classList.toggle("card__like-button_is-active"),p.textContent=e.likes.length})).catch((function(e){console.error("Ошибка при обновлении лайка:",e)}))})),e.owner._id===t?s.addEventListener("click",(function(t){var n,o=t.currentTarget.closest(".card");(n=e._id,fetch("https://nomoreparties.co/v1/".concat(i,"/cards/").concat(n),{method:"DELETE",headers:{authorization:u,"Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){throw console.error("Ошибка удаления карточки:",e),e}))).then((function(){return o.remove()})).catch((function(e){return console.error("Ошибка удаления карточки:",e)}))})):s.style.display="none",o.addEventListener("click",(function(){y.src=e.link,y.alt=e.name,m.textContent=e.name,r(_)})),n}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}new URL(n(576),n.b),new URL(n(117),n.b),new URL(n(629),n.b),Promise.all([s(),p()]).then((function(e){var t,n,o=(n=2,function(e){if(Array.isArray(e))return e}(t=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,a,i=[],u=!0,s=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(i.push(o.value),i.length!==t);u=!0);}catch(e){s=!0,r=e}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(s)throw r}}return i}}(t,n)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?v(e,t):void 0}}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),r=o[0];o[1],d=r._id})).catch((function(e){return console.error("Ошибка загрузки данных:",e)}));var S=document.querySelector(".popup_type_edit"),b=document.querySelector(".popup_type_new-card"),q=document.querySelector(".popup_type_image"),k=document.querySelector(".popup_type_edit_avatar"),L=S.querySelector(".popup__input_type_name"),g=S.querySelector(".popup__input_type_description"),j=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),C=document.querySelector(".profile__image");function x(){L.value=j.textContent,g.value=E.textContent}function T(){c(S)}!function(e,t,n){s().then((function(o){e.textContent=o.name,t.textContent=o.about,n.style.backgroundImage='url("'.concat(o.avatar,'")')})).catch((function(e){return console.error("Ошибка запроса информации о пользователе:",e)}))}(j,E,C),S.classList.add("popup_is-animated"),b.classList.add("popup_is-animated"),q.classList.add("popup_is-animated"),k.classList.add("popup_is-animated"),x(),document.querySelector(".profile__edit-button").addEventListener("click",(function(){x(),r(S)})),S.querySelector(".popup__close").addEventListener("click",T);var w=S.querySelector(".popup__form"),P=w.querySelector(".popup__input_type_name"),A=w.querySelector(".popup__input_type_description"),O=w.querySelector(".popup__button");function z(){c(k)}w.addEventListener("submit",(function(e){e.preventDefault();var t=P.value,n=A.value;l(!0,O),function(e,t){return fetch("https://nomoreparties.co/v1/".concat(i,"/users/me"),{method:"PATCH",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.error("Ошибка обновления информации о пользователе:",e)}))}(t,n).then((function(e){j.textContent=e.name,E.textContent=e.about,T()})).catch((function(e){console.error("Не удалось обновить профиль:",e)})).finally((function(){l(!1,O)}))})),document.querySelector(".profile__image").addEventListener("click",(function(){r(k)})),k.querySelector(".popup__close").addEventListener("click",z);var I=k.querySelector(".popup__form"),U=I.querySelector(".popup__input_type_url"),D=I.querySelector(".popup__button");function N(){c(b)}I.addEventListener("submit",(function(e){e.preventDefault();var t,n=U.value;l(!0,D),(t=n,fetch("https://nomoreparties.co/v1/".concat(i,"/users/me/avatar"),{method:"PATCH",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({avatar:t})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.error("Ошибка добавления аватарки пользователю:",e)}))).then((function(e){C.style.backgroundImage='url("'.concat(e.avatar,'")'),console.log(e.avatar),z()})).catch((function(e){console.error("Ошибка загрузки аватарки:",e)})).finally((function(){l(!1,D)}))})),document.querySelector(".profile__add-button").addEventListener("click",(function(){r(b)})),b.querySelector(".popup__close").addEventListener("click",N);var R=b.querySelector(".popup__form"),J=R.querySelector(".popup__input_type_card-name"),G=R.querySelector(".popup__input_type_url"),H=R.querySelector(".popup__button");R.addEventListener("submit",(function(e){e.preventDefault();var t,n,o=J.value,r=G.value;l(!0,H),(t=o,n=r,fetch("https://nomoreparties.co/v1/".concat(i,"/cards"),{method:"POST",headers:{authorization:u,"Content-Type":"application/json"},body:JSON.stringify({name:t,link:n})}).then((function(e){return e.ok?e.json():Promise.reject(e.status)})).catch((function(e){console.error("Ошибка добавления новой карточки:",e)}))).then((function(e){var t=h({name:e.name,link:e.link,owner:{_id:d},_id:e._id,likes:[]},d);M.prepend(t),N()})).catch((function(e){console.error("Не удалось добавить новую карточку:",e)})).finally((function(){l(!1,H)}))})),q.querySelector(".popup__close").addEventListener("click",(function(){c(q)}));var M=document.querySelector(".places__list");p().then((function(e){!function(e){e.forEach((function(e){var t=h(e,d);M.appendChild(t)}))}(e),console.log(e)})),document.querySelectorAll("form").forEach((function(e){!function(e){var t=e.querySelectorAll("input"),n=e.querySelector(".popup__button");o(t,n),t.forEach((function(r){r.addEventListener("input",(function(){!function(e,t){t.validity.valid?function(e,t){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("popup__input_type_error"),n.textContent=""}(e,t):function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.add("popup__input_type_error"),o.textContent=n}(e,t,t.validationMessage)}(e,r),o(t,n)}))}))}(e)}))})();